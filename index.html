<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Audio Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.1043.0/aws-sdk.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/amazon-cognito-identity-js/5.0.3/amazon-cognito-identity.min.js"></script>
    <style>
        /* Your CSS styles here */
    </style>
</head>

<body>
<h1>Welcome to Audio Generator</h1>

<div id="auth-section">
    <h2>Sign In</h2>
    <form id="signin-form">
        <label for="signin-username">Username:</label>
        <input type="text" id="signin-username" required><br>
        <label for="signin-password">Password:</label>
        <input type="password" id="signin-password" required><br>
        <button type="submit">Sign In</button>
    </form>
    <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
</div>

<div id="register-section" style="display: none;">
    <h2>Register</h2>
    <form id="register-form">
        <label for="register-username">Username:</label>
        <input type="text" id="register-username" required><br>
        <label for="register-password">Password:</label>
        <input type="password" id="register-password" required><br>
        <button type="submit">Register</button>
    </form>
    <p>Already have an account? <a href="#" id="show-signin">Sign In</a></p>
</div>

<div id="protected-section" style="display: none;">
    <h2>Welcome, <span id="user-username"></span>!</h2>
    <form id="audio-form">
        <label for="input-text">Insert your prompt to generate music (describe the type of music you want to
            listen):</label> <br>
        <input type="text" id="input-text">
        <br>
        <button type="submit" id="submit-btn">Generate Music</button>
    </form>
    <table id="results-table">
        <thead>
        <tr>
            <th id="prompt-header">Prompt</th>
            <th>Generated Music</th>
            <th id="date-header">Date</th>
            <th>Rating</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <button id="signout-button">Sign Out</button>
</div>

<script>
    // Initialize Amazon Cognito
    var poolData = {
        UserPoolId: 'us-east-1_lMzoOd4YI',
        ClientId: '6q3a6n2v70tak76od484n349cs'
    };
    var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

    var authenticationData = {
        Username: '',
        Password: '',
    };

    var authenticationDetails;

    // Check if a user is already authenticated
    var currentUser = userPool.getCurrentUser();

    function hideAllSections() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('register-section').style.display = 'none';
        document.getElementById('protected-section').style.display = 'none';
    }

    if (currentUser) {
        // User is already authenticated, show protected section
        hideAllSections();
        document.getElementById('protected-section').style.display = 'block';
        document.getElementById('user-username').textContent = currentUser.getUsername();
    } else {
        // No user is authenticated, show sign-in section
        hideAllSections();
        document.getElementById('auth-section').style.display = 'block';
    }

    // Show the registration form
    document.getElementById('show-register').addEventListener('click', function (e) {
        e.preventDefault();
        hideAllSections();
        document.getElementById('register-section').style.display = 'block';
    });

    // Show the sign-in form
    document.getElementById('show-signin').addEventListener('click', function (e) {
        e.preventDefault();
        hideAllSections();
        document.getElementById('auth-section').style.display = 'block';
    });

    // Sign In
    document.getElementById('signin-form').addEventListener('submit', function (e) {
        e.preventDefault();
        authenticationData.Username = document.getElementById('signin-username').value;
        authenticationData.Password = document.getElementById('signin-password').value;
        authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

        var userData = {
            Username: authenticationData.Username,
            Pool: userPool,
        };

        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function (session) {
                hideAllSections();
                document.getElementById('protected-section').style.display = 'block';
                document.getElementById('user-username').textContent = cognitoUser.getUsername();
            },
            onFailure: function (err) {
                alert('Authentication failed: ' + err.message);
            },
            newPasswordRequired: function (userAttributes, requiredAttributes) {
                // Handle new password requirements if necessary
                // You can redirect the user to a password change form
            }
        });
    });

    // Register
    document.getElementById('register-form').addEventListener('submit', function (e) {
        e.preventDefault();
        var username = document.getElementById('register-username').value;
        var password = document.getElementById('register-password').value;

        userPool.signUp(username, password, [], null, function (err, result) {
            if (err) {
                alert('Registration failed: ' + err.message);
                return;
            }
            // Registration successful, show sign-in form
            hideAllSections();
            document.getElementById('auth-section').style.display = 'block';
            alert('Registration successful. Please sign in.');
        });
    });

    // Sign Out
    document.getElementById('signout-button').addEventListener('click', function () {
        currentUser.signOut();
        hideAllSections();
        document.getElementById('auth-section').style.display = 'block';
    });

    // Your existing code for generating and displaying audio data goes here

</script>

</body>
</html>
